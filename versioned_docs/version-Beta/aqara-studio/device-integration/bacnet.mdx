# BACnet

This document explains how to connect BACnet devices to Aqara Studio.

## Prerequisites

Before you start, please make sure your network meets these conditions based on your device type:
- For BACnet/IP devices: The BACnet/IP device, Aqara gateway, and your computer must be on the same local area network (LAN).
- For BACnet MS/TP devices: The BACnet MS/TP device is already connected to a BACRouter, and the BACRouter, Aqara gateway, and your computer are all on the same LAN.

## Add a BACnet Device

1. On the left sidebar, click to enter the **Devices** page.
2. In the device tree on the left, click the “+” button. In the popup, choose `BACnet IP`.
3. Select `BACnet IP` to open the management page.
4. Go to the `Protocol Configuration` tab and set the following parameters for this protocol:

    <table>
        <colgroup>
            <col />
            <col />
            <col />
            <col />
            <col />
        </colgroup>
        <thead>
            <tr>
                <th>Category</th>
                <th>Parameter</th>
                <th>Required</th>
                <th>Description</th>
                <th>Example</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td rowspan="4">Basic Configuration</td>
                <td>Network Number</td>
                <td>✔</td>
                <td>It identifies the logical subnet, and must be unique. Range: [0, 65535]. <ul><li>0: Local network</li><li>65535: Broadcast network</li></ul></td>
                <td>1</td>
            </tr>
            <tr>
                <td>UDP Port</td>
                <td>✔</td>
                <td>The UDP port for BACnet/IP communication. Default is 47808 (0xBAC0).</td>
                <td>47808</td>
            </tr>
            <tr>
                <td>Local IP Address</td>
                <td>✘</td>
                <td>The IP address of the device on which Aqara Studio is deployed. Format: xxx.xxx.xxx.xxx (for example, 192.168.1.100). Default is 0.0.0.0, which allows the system to assign it automatically.</td>
                <td>1</td>
            </tr>
            <tr>
                <td>Device Object Instance Number</td>
                <td>✔</td>
                <td>A unique identifier for the BACnet device on the BACnet network. Range: [0, 4194303].</td>
                <td>1</td>
            </tr>
            <tr>
                <td rowspan="3">Worker Mode Configuration</td>
                <td>BACnet/IP Device Type</td>
                <td>✘</td>
                <td>The following options are supported:<ul><li><strong>Standard Device</strong>: General BACnet devices (such as controllers, servers, clients) that use UDP port 47808 (default).</li><li><strong>Foreign Device</strong>: Not on the local subnet, must be registered with BBMD to enable cross-subnet communication.</li><li><strong>Broadcast Management Device (BBMD)</strong>: Manages foreign device registration, forwards broadcast messages, and maintains the broadcast table.</li></ul></td>
                <td>Standard Device</td>
            </tr>
            <tr>
                <td>BBMD UDP Port</td>
                <td>✘</td>
                <td>The listening port for BBMD services, default is 47808. Required if the BACnet/IP device mode is <code>Foreign Device</code> or <code>Broadcast Management Device</code>.</td>
                <td>47808</td>
            </tr>
            <tr>
                <td>BBMD IP Address</td>
                <td>✘</td>
                <td>The IP address of the BBMD. This is the target for foreign device registration and is used for cross-subnet broadcasts. Required if device mode is <code>Foreign Device</code> or <code>Broadcast Management Device</code>.</td>
                <td>null</td>
            </tr>
            <tr>
                <td rowspan="6">Advanced Configuration</td>
                <td>Max APDU Length Accepted (bytes)</td>
                <td>✘</td>
                <td>The maximum supported APDU (Application Protocol Data Unit) length in bytes. It is recommended to set no larger than 1476.</td>
                <td>1076</td>
            </tr>
            <tr>
                <td>Segmentation Supported</td>
                <td>✘</td>
                <td>Options:<strong>Segmented Both (default)</strong>: The device supports segmented APDU messages both for sending and receiving. <strong>Segmented Transmit</strong>: Only supports sending segmented messages. <strong>Segmented Receive</strong>: Only supports receiving segmented messages. <strong>No Segmentation</strong>: Does not support segmented messages. Only messages within the max APDU length are supported.</td>
                <td>Segmented Both</td>
            </tr>
            <tr>
                <td>APDU Segment Timeout</td>
                <td>✘</td>
                <td>The timeout for waiting for a segment acknowledgment when transmitting segmented APDU. Default is 2000ms.</td>
                <td>2s</td>
            </tr>
            <tr>
                <td>APDU Timeout</td>
                <td>✘</td>
                <td>Applies only for non-segmented APDU transfers. Defines how long to wait for a response (such as ACK or Error). Default is 30000ms.</td>
                <td>30s</td>
            </tr>
            <tr>
                <td>Character Set</td>
                <td>✘</td>
                <td>The character set used, to ensure text information can be correctly encoded and decoded between devices. Supported options: ISO_10646_UTF8, IBM_MICROSOFT_DBCS, JIS_X0208, ISO_10646_UCS4, ISO_10646_UCS2, ISO_8859_1, UNKNOWN.</td>
                <td>ISO_10646_UTF8</td>
            </tr>
            <tr>
                <td>Enable/Disable Network</td>
                <td>✘</td>
                <td>Note: If disabled, devices on this network will not work.</td>
                <td>-</td>
            </tr>
        </tbody>
    </table>

3. (Optional) Go to the "Add Device" tab, and click the ⚙ button to set up device discovery rules.

    The following discovery rule fields can be set:

    <table>
        <thead>
            <tr>
                <th>Field Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Device objectId &ge;</td>
                <td>Search for devices with instance numbers greater than or equal to this value. Minimum is 0.</td>
            </tr>
            <tr>
                <td>Device objectId &le;</td>
                <td>Search for devices with instance numbers less than or equal to this value. Maximum is 4194302.</td>
            </tr>
            <tr>
                <td>Network Instance Filter</td>
                <td>Control which network numbers to discover, such as <code>1,2,3,4</code>. Default is <code>all</code>.</td>
            </tr>
            <tr>
                <td>Wait Response Time</td>
                <td>The time for the discovery process, in seconds. <br /><strong>Note:</strong> If device discovery fails or some devices are not found, adjust this field based on network conditions.</td>
            </tr>
        </tbody>
    </table>
   
4. Click the “Discover Devices” button. Aqara Studio will then scan the network to find devices.

    :::tip
    If Aqara Studio does not find your BACnet device, you can also [add the device manually](#how-to-handle-bacnet-devices-not-discovered-by-aqara-studio).
    :::

5. Select the device(s) you want to add, and click the "+" button in the center. The newly added device(s) will appear in the **Added Device List** on the right, and will also be displayed under BACnet IP in the device tree on the left.

6. In the device tree, select the newly added device to enter its configuration page. Go to the `Point` tab and click the `Add point` button. In the "Add point" page, click **Discover Points** button, Aqara Studio will begin scanning to discover function points for this device.

    :::tip
    > If the system does not discover the function points you need, you can also [add them manually](#how-to-handle-bacnet-points-not-discovered-by-aqara-studio).
    :::

7. Select the required points and click the blue "+" button. The newly added points will appear in the **Added Points** list on the right, and will also be displayed under the corresponding device in the device tree on the left.

## Next Steps

Now, you can [view details and control the device](./../device-management/basic-information.mdx), or [use the device in automation](./../automation.mdx).

## FAQ

### How to Handle BACnet Devices Not Discovered by Aqara Studio

If Aqara Studio does not find your BACnet device, click "Manually Add." In the "Add Device" popup, enter the required parameters to finish adding the device.

Details for each parameter are as follows:

| Parameter            | Required | Description | Example |
|----------------------|----------|-------------|---------|
| Device Name          | ✔        | Your custom name for the BACnet device. |         |
| Device Object Instance Number | ✔      | Unique ID for the BACnet device on the BACnet network. Range: [0, 4194303]. | 1       |
| Network Number        | ✔       | Identifies the logical subnet, must be unique. Range: [0,65535]. 0: Local, 65535: Broadcast | 1 |
| MAC Address           | ✘       | MAC address of the device. | - |
| Address Type          | ✘       | Specify the format and protocol type of MAC address:<ul><li>UNKNOWN: Unknown type</li><li>ETHERNET: 6-byte Ethernet MAC, format AA:BB:CC:DD:EE:FF</li><li>IP: 4-6 byte IP address, format 192.168.1.1:47808</li><li>MSTP: 1 byte, Master-Slave/Token-Passing</li><li>SC: 6-byte Secure Connection, WebSocket</li></ul> | - |
| Max APDU Length Accepted (bytes) | ✘ | The maximum APDU (Application Protocol Data Unit) length in bytes. Recommended no larger than 1476. | 1076    |
| Segmentation Supported    | ✘ | Options: <ul><li>Send and Receive Segmentation (default): Supports both sending and receiving segmented APDUs.</li><li>Send Only: Only supports sending segmented messages.</li><li>Receive Only: Can only receive segmented messages.</li><li>No Segmentation: Only unsegmented messages within the length limit are supported.</li></ul> | Send and Receive Segmentation |
| Encoding              | ✘       | Character encoding used. Supported: <ul><li>ISO_10646_UTF8</li><li>IBM_MICROSOFT_DBCS</li><li>JIS_X0208</li><li>ISO_10646_UCS4</li><li>ISO_10646_UCS2</li><li>ISO_8859_1</li><li>UNKNOWN</li></ul> | ISO_10646_UTF8 |
| Vendor Name           | ✘       | Name of the device manufacturer. | - |
| Model Name            | ✘       | Model name of the device. | - |
| Protocol Revision     | ✘       | Enter the `Protocol_Revision` property from BACnet. | - |
| Firmware Version      | ✘       | Enter the `Firmware_Revision` property from BACnet. | - |
| Application Software Version | ✘ | Enter the `Application_Software_Version` property from BACnet. | - |

### How to Handle BACnet Points Not Discovered by Aqara Studio

If Aqara Studio does not find the points you need, click "Manually Add" on the Point Add page, and enter the point parameters in the popup.

Details for each parameter are as follows:

| Parameter           | Required | Description |
|---------------------|----------|-------------|
| Point Name          | ✔        | You can set a custom name for this point. |
| Aqara Object Type   | ✘        | Object type defined by Aqara. |
| Object Type         | ✔        | Object type as defined by BACnet. |
| Object Instance identifier | ✘     | The instance number for this point. Range: [0, 4194303]. |
