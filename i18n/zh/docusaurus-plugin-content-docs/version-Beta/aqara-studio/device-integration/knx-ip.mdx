# KNX IP 设备接入

本文说明如何将 KNX/IP 设备接入 Aqara Studio。

## 前提条件

在开始之前，请确保：
- 已在 [ETS6](https://www.knx.org/knx-en/for-professionals/software/ets6/) 上添加了 KNX/IP 设备、为其添加组地址、获取其物理地址和 DPT 数据类型。如需了解相关教程，请阅读 KNX 协会的 [ETS6 Professional 官网文档](https://support.knx.org/hc/en-us/sections/4404423716242-ETS6-Professional)，或观看 [ETS for beginners 系列视频](https://www.youtube.com/playlist?list=PL9NWvz0cOjNOboCuten_R6gmMvKhhO3xZ)。 
- 您的 Windows 电脑、KNX/IP 设备和 Aqara 网关处于同一局域网。

## 添加 KNX/IP 设备

1. 在左侧侧边栏点击进入**设备管理**页面。
2. 在左侧协议目录单击“+”按钮，在弹窗中选择 `KNX IP`，以添加 `KNX IP` 文件夹。
3. 右键单击 `KNX IP` 文件夹，选择**增加**，此时你可以看到该目录下出现一个 `KNX IP 设备` 文件夹。
4. 双击该文件夹，在**概览**选项卡，你可以修改该设备的`显示名称`。
5. 切换至**配置**选项卡，展开**设备配置**，填写如下参数：

   <table>
     <thead>
       <tr>
         <th>参数名称</th>
         <th>说明</th>
       </tr>
     </thead>
     <tbody>
       <tr>
         <td>设备地址</td>
         <td>KNX 设备在 KNX 网络中的唯一地址标识符，传入您在 ETS6 添加设备时设置的物理地址，格式为三段式（如 1.1.0）。</td>
       </tr>
       <tr>
         <td>本地 IP 地址</td>
         <td>本地设备（客户端）的 IP 地址，用于与 KNX 网络通信；默认使用：0.0.0.0 表示系统自动分配。</td>
       </tr>
       <tr>
         <td>连接类型</td>
         <td>选择您设备支持的连接模式：<ul><li><strong>隧道模式</strong>：适用于点对点连接（如下载程序、智能家居系统）。</li><li><strong>路由模式</strong>：组播连接（用于监控总线流量或组播方式控制）。</li></ul><strong>说明：</strong>如果您不清楚设备的连接类型，请阅读设备说明书，或咨询该设备厂商技术支持。</td>
       </tr>
       <tr>
         <td>KNX 隧道 IP 地址</td>
         <td>KNX 隧道服务器的 IP 地址，用于建立 KNX/IP 隧道连接；作为 KNX 网络与 IP 网络之间的网关，提供 KNX/IP 隧道服务，转发 KNX 数据包。当连接类型为“隧道模式”，必填。格式：xxx.xxx.xxx.xxx（如：192.168.1.100）</td>
       </tr>
       <tr>
          <td>路由器 IP 地址</td>
          <td>KNX/IP 路由器的 IP 地址，当连接类型为“路由模式”，必填，用于 KNX 网络路由节点，转发 KNX 数据包到目标设备。</td>
       </tr>
       <tr>
         <td>KNX 隧道端口号</td>
         <td>KNX 接口设备的端口号，当连接类型为“隧道模式”，必填。默认为 3671，如果您曾经调整过端口号，请以您更新过的号码为准。</td>
       </tr>
     </tbody>
   </table>
6. 展开**高级配置**，您可以决定是否启用该设备。
7. 切换至**点发现**，**点击上传**设备对应的 KNXPROJ 文件或群组地址 XML 文件（均可通过 ETS6 导出）。文件上传成功后，点击 **发现点**，系统将自动解析文件并生成可添加的点位列表。
8. 勾选需要的点，单击蓝色 **+** 按钮，即可完成添加。
    
## 下一步

接下来，您可以直接 [查看该设备的详情和控制该设备](./../device-management/basic-information.mdx)，还可以利用该设备 [编排自动化逻辑](./../automation.mdx) 了。

## 常见问题

### 如何修改和手动添加 KNX 点位

在添加点的页面，如果您需要修改已发现的点的信息，或想要手动添加点，可参考如下方式，分别单击“添加”或“手动添加”。

此时，您会看到一个“点添加”弹窗，在该弹窗中提供下表所示信息，即可完成：

| 参数名称   | 说明 |
|------------|-----|
| KNX点名称  | 您自定义的点位名称。 |
| KNX组地址  | 点位对应的 KNX 组地址，此字段您在 ETS6 上配置的相关字段。 |
| 数据点类型 | 点位的数据类型（DPT），此字段您在 ETS6 上配置的相关字段。 |
| Aqara对象类型   | 点位所属的设备类型。此字段在您将 KNX 设备接入 Aqara Home 时作展示用途。 |