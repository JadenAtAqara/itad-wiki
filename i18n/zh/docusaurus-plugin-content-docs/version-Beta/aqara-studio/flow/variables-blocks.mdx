# 变量

> **说明**
>
> 截图与实际界面可能有所不同，请以实际为准。

## 概述

在自动化逻辑中，**变量**是实现灵活性和可扩展性的核心要素。通过 Aqara Studio，您不仅能够 [将设备实时采集的数据赋值为变量](#赋值变量)，还可以自定义多种类型（[布尔](#布尔变量)、[字符串](#字符串常量)、[数值](#数值变量)）的变量，从而在自动化流程中实现数据的存储与[计算](./other-blocks.mdx#数值运算)、[与预设值的比较和逻辑判断](./logic-blocks.mdx#逻辑运算)、[文本拼接](./other-blocks.mdx#文本拼接)，甚至支持更高级的[自定义数据处理脚本](./other-blocks.mdx#脚本卡片)。


变量类包含的卡片如下图所示：
<img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-Total.png" alt="变量类卡片概览" style={{ width: '80%' }} />   

## 赋值变量

### 功能

如果您希望将设备采集到的实时数据（如温度、湿度、亮度、开关状态等）保存为变量，可使用“赋值变量”卡片。

### 组成

<img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-DeviceData.png" alt="赋值变量卡片组成" style={{ width: '80%' }} />   
此卡片为**双点型**，说明如下：

| 连接点或参数 | 是否必选 | 说明 |
| -- | -- | -- |
| 输入点 | ✘ | 用于控制设备，可连接其他 `赋值变量`、[数值运算](./other-blocks.mdx#数值运算)、[逻辑运算](./logic-blocks.mdx#逻辑运算)、[文本拼接](./other-blocks.mdx#文本拼接) 或 [脚本卡片](./other-blocks.mdx#脚本卡片)，通过获取它们的值，修改自己的值。 |
| 输出点 | ✘ | 用于输出实时数据，可连接其他 `赋值变量`、[数值运算](./other-blocks.mdx#数值运算)、[逻辑运算](./logic-blocks.mdx#逻辑运算)、[文本拼接](./other-blocks.mdx#文本拼接) 或 [脚本卡片](./other-blocks.mdx#脚本卡片)。 |

### 使用步骤

`赋值变量`卡片的使用步骤如下：

1. 选择该卡片后，系统将弹出设备选择窗口，您可以查看目标设备支持的**局部设备变量**。勾选所需项后，您可以在画布任意位置会添加对应的监听卡片，开始实时监听相关内容。

    <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-SelectDeviceData.png" alt="选择局部设备变量" style={{ width: '80%' }} />   
2. 在卡片左侧连接提供值的卡片，或在卡片右侧连接需要传入值的卡片，如赋值变量、数值运算、逻辑运算、数值变量、文本拼接或脚本卡片。

    <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-DeviceDataConnection.png" alt="连接其他需要数值的卡片" style={{ width: '80%' }} />   
## 布尔变量

### 功能

当您需要自定义一个布尔值（true/false），或在流程中记录并传递布尔型型的数据时，可使用此卡片创建一个**局部布尔变量**。

### 组成

<img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-BooleanCardIntro.png" alt="布尔变量卡片介绍" style={{ width: '80%' }} />   
此卡片为**双点类型**，拥有 1 个可配置参数，说明如下：

| 连接点或参数 | 是否必选 | 说明 |
| - | - | - |
| 输入点 | ✘ | 接收布尔变量，仅支持连接 [脚本卡片](./other-blocks.mdx#脚本卡片)。 |
| 布尔值 | ✘ | 其含义取决于输入点和输出点的连接情况：<ul><li>当输入点已连接`脚本卡片`时，本字段显示为该脚本输出的布尔值。</li><li>当输出点连接至`脚本卡片`时，需由用户手动设置此值，作为脚本参数。</li></ul> |
| 输出点 | ✘ | 输出布尔变量，仅支持连接 [脚本卡片](./other-blocks.mdx#脚本卡片)。 |

> **注意**
>
> 本卡片的输入点、布尔值和输出点均为可选项，用户可根据实际逻辑需求灵活选择是否连接或配置。

### 使用步骤

根据您的使用场景，`布尔变量`卡片的使用步骤如下：

#### 作为脚本参数

1. 使用布尔变量卡片定义 1 个布尔值。
2. 在卡片右侧连接 1 个脚本卡片。

#### 记录脚本运行结果

 <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-BooleanBlockUsage.png" alt="布尔卡片记录脚本运行" style={{ width: '80%' }} />   
1. 使用脚本卡片定义如何处理输入数据，以及输出数据为布尔型型。
2. 在脚本卡片后，连接一个布尔变量卡片。当脚本运行后，卡片内的布尔值显示为运行结果。

## 数值变量

### 功能

当您需要自定义一个数值，或在流程中记录、传递数值类型的数据时，可使用此卡片创建一个**局部数值变量**。

### 组成

<img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-NumberIntro.png" alt="数值变量说明" style={{ width: '80%' }} />   
此卡片为**双点类型**，拥有 1 个可配置参数，说明如下：

| 连接点或参数 | 是否必选 | 说明 |
| - | - | - |
| 输入点 | ✘ | 接收数值变量，支持连接 [数值运算](./other-blocks.mdx#数值运算) 和 [脚本卡片](./other-blocks.mdx#脚本卡片)。 |
| 数值 | ✘ | 其含义取决于输入点和输出点的连接情况：<ul><li>当输入点已连接`数值运算`或`脚本卡片`时，本字段显示为`运算结果`或`脚本运行结果`。</li><li>当输出点连接至 `数值运算`、`逻辑运算`、`脚本卡片` 卡片时，需由用户手动设置此值，作为参数。</li></ul> |
| 输出点 | ✘ | 输出您自定义的数值，支持连接 [数值运算](./other-blocks.mdx#数值运算)、[逻辑运算](./logic-blocks.mdx#逻辑运算)、[脚本卡片](./other-blocks.mdx#脚本卡片)。 |

> **注意**
>
> 本卡片的输入点、数值和输出点均为可选项，用户可根据实际逻辑需求灵活选择是否连接或配置。

### 使用步骤

根据您的使用场景，`数值变量`卡片的使用步骤如下：

#### 作为数值运算参数、逻辑运算参数或脚本参数

1. 使用数值变量卡片定义 1 个数值。
2. 在卡片右侧连接 1 个数值运算卡片、逻辑运算卡片或脚本卡片。

#### 记录脚本运行结果

1. 使用脚本卡片定义如何处理输入数据，以及输出数据为数值类型。
2. 在脚本卡片后，连接一个数值变量卡片。当脚本运行后，卡片内的数值显示为运行结果。

#### 记录数值运算或逻辑运算结果

1. 在卡片左侧连接一个数值运算卡片或逻辑运算卡片，即可接收运算结果。

## 字符串常量

### 功能

当您需要自定义一个字符串，或在流程中记录、传递字符串类型的数据时，可使用此卡片创建一个**局部字符串常量**。

### 组成

<img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-StringIntro.png" alt="字符串常量卡片介绍" style={{ width: '80%' }} />   
此卡片为**双点类型**，拥有 1 个可配置参数，说明如下：

| 连接点或参数 | 是否必选 | 说明 |
| - | - | - |
| 输入点 | ✘ | 接收字符串，仅支持连接 [脚本卡片](./other-blocks.mdx#脚本卡片) 或 [文本拼接](./other-blocks.mdx#文本拼接)。 |
| 字符串内容 | ✘ | 其含义取决于输入点和输出点的连接情况：<ul><li>当输入点已连接`脚本卡片`时，本字段显示为该脚本输出的字符串内容。</li><li>当输出点连接至 `脚本卡片` 或 `文本拼接` 卡片时，需由用户手动设置此值，作为脚本参数或文本拼接部分。</li></ul> |
| 输出点 | ✘ | 输出字符串，仅支持连接 [脚本卡片](./other-blocks.mdx#脚本卡片) 或 [文本拼接](./other-blocks.mdx#文本拼接)。 |

> **注意**
>
> 本卡片的输入点、字符串内容和输出点均为可选项，用户可根据实际逻辑需求灵活选择是否连接或配置。

### 使用步骤

根据您的使用场景，`字符串常量`卡片的使用步骤如下：

#### 作为脚本参数或文本拼接部分

1. 使用字符串常量卡片定义 1 个字符串。
2. 在卡片右侧连接 1 个脚本卡片或文本拼接卡片。

#### 记录脚本运行结果

1. 使用脚本卡片定义如何处理输入数据，以及输出数据为字符串类型。
2. 在脚本卡片后，连接一个字符串常量卡片。当脚本运行后，卡片内的字符串显示为运行结果。

#### 记录文本拼接结果

1. 在卡片左侧连接一个文本拼接卡片，即可接收拼接结果。

## 全局变量

通过 [布尔变量](#布尔变量)、[数值变量](#数值变量)、[字符串常量](#字符串常量) 等卡片创建的变量默认是局部变量，仅在当前自动化逻辑中可用。

当您需要在多个自动化逻辑中复用变量时，您需要使用全局变量。

### 设置全局变量

全局变量的设置方式包括两种：
- [转换现有局部变量](#转换现有局部变量)
- [新建全局变量](#新建全局变量)

#### 转换现有局部变量

右键单击现有变量卡片，选择“设置为全局变量”，即可将该变量转换为全局变量的定义卡片。

<img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-SetGlobalVariable.png" alt="右键单击现有变量卡片" style={{ width: '80%' }} />   
#### 新建全局变量

1. 在画布上方单击`全局变量`按钮，并在弹窗选择`新建变量`。

    <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-CreateNewGlobal.png" alt="新建全局变量" style={{ width: '80%' }} />   
2. 在弹窗中设置变量类型、变量名称和值，完成后单击 “确认”。

    <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-CreationDialogue.png" alt="设置全局变量" style={{ width: '80%' }} />   
3. 确认后，您需要将该变量卡片放置在画布的任意位置，它将作为全局变量的定义卡片供引用。

### 使用全局变量

1. 画布上方单击`全局变量`按钮，在弹窗中选择需要的变量。
   
    <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-SelectAddedVariable.png" alt="选择新增的全局变量" style={{ width: '80%' }} />   
2. 点击画布任意位置，即可生成该全局变量卡片。该卡片为 **双点型**，既可以接收新值，也可以输出自己的值。请根据变量的类型，参考上文相应变量卡片的说明，将其连接到其他卡片。
   
   <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/VariableBlock-GlobalVariableIntro.png" alt="添加新增的全局变量" style={{ width: '80%' }} />   