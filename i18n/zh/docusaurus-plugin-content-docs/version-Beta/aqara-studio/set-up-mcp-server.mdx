# 连接至 Aqara Studio MCP Server

## 什么是 MCP？

[Model Context Protocol](https://modelcontextprotocol.io/docs/getting-started/intro)（MCP，模型上下文协议）是一种开源标准，用于为 AI 应用提供与外部系统连接的统一接口。通过 MCP，像 ChatGPT、Claude 这样的 AI 可以安全、标准化地接入数据源（文件、数据库）、工具（搜索、计算）以及工作流（专业提示与自动化流程），从而在理解上下文的同时执行真实任务。

MCP 的价值在于降低集成成本、扩展 AI 能力并提升用户体验：开发者能更快构建和复用能力，AI 应用能接入丰富生态并变得更强大，终端用户则获得真正“可行动”的智能助手。无论是个人助理、企业级聊天分析，还是设计、编程与自动化场景，MCP 都为 AI 与现实系统之间架起了高效、可扩展的桥梁。

## 你可以通过 Aqara Studio MCP Server 做什么？

连接 Aqara Studio MCP Server 后，您可以通过各类 AI 应用实时查看并控制您在 Aqara Studio 已接入的所有设备，实现设备状态监控与便捷操控。

## 获取 MCP Server URL

不同的 AI 应用对 MCP Server 的 URL 地址格式有不同要求。常见有两类：

### 局域网地址

局域网地址适用于 **Cursor** 等支持直接访问您电脑本地或所在局域网设备的应用。

- 前提条件：确保 Aqara Studio 和 Cursor 等应用在同一局域网下运行。
- 格式：`http://局域网内网IP/open/api/mcp`

    :::tip
    局域网内网 IP 为 Aqara Studio 的本机地址。
    :::

- 示例：`http://192.168.1.2/open/api/mcp`

### 远程访问地址

远程访问地址适用于 **ChatGPT、Manus 等仅能通过公网访问的应用**，如 **OpenAI** 平台仅支持采用 **HTTPS** 协议的 MCP Server 地址，不支持 HTTP 协议地址。

- 前提条件：已获取 Aqara Studio 的 [远程访问地址](./remote-access.mdx)。
- 格式：`https://远程访问地址/open/api/mcp`
- 示例：`https://your-mcp-domain.example.com/open/api/mcp`

:::tip
- ChatGPT/Manus 这类纯云端 LLM 工具，只能访问公网 HTTPS 地址，无法连接仅在本地或局域网暴露的 `http://` 地址。
- 若只需要本地或同一局域网访问，局域网 MCP 地址即可。
- 若需要云端 AI 应用（如 ChatGPT/GPTs）访问，则必须提供公网 HTTPS 地址。
:::

## 获取 Token

请参考 [开发者指南 - 获取必要信息](./developer-guide.mdx#获取必要信息)，获取授权 Token，用于通过用户身份验证，以便与 Aqara Studio MCP Server 建立连接。

Token 的格式为 `Bearer <token>`，将 `<token>` 替换为您从 Aqara Studio 获取的 Token 字符串（若从 Aqara Studio 获取的令牌已带 Bearer 前缀，请直接使用，无需重复添加）。

## 在 Cursor 上使用 MCP

:::tip
如需了解 Cursor 对 MCP 的说明，请参考：[模型上下文协议（MCP）](https://cursor.com/cn/docs/context/mcp#installing-mcp-servers)。
:::

1. 在 Cursor 打开 Settings，在侧边栏选择 **Tools & MCP**，并单击 **Add Custom MCP**，以打开 `mcp.json` 文件。

    ![在 Cursor 选择 Add Custom MCP](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-cursor1.png)

    ![初始 mcp.json 文件](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-cursor2.png)

2. 将以下代码复制粘贴到该文件，替换原有的内容,然后保存，如下图所示。

    ![更新 mcp.json 文件](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-cursor3.png)

    ```json
    {
        "mcpServers": {
            /* 
             * 以下为通过局域网访问 Aqara Studio MCP Server 的配置
             * LocalSmartDeviceControl 为您自定义的 MCP server 名称 
             */
            "LocalSmartDeviceControl": {
                "url": "http://10.xx.xx.xx/open/api/mcp", // 替换为 Aqara Studio 的本机地址
                "headers": {
                    "Authorization": "Bearer xxx"  // 替换 xxx 为您从 Aqara Studio 获取的 token
                }
            },
            /* 
             * 以下为通过远程访问 Aqara Studio MCP Server 的配置
             * RemoteSmartDeviceControl 为您自定义的 MCP server 名称 
             */
            "RemoteSmartDeviceControl": {
                "url": "https://xxx.xxx.xxx/open/api/mcp", // 替换 xxx.xxx.xxx 为 Aqara Studio 的远程访问地址
                "headers": {
                    "Authorization": "Bearer xxx" // 替换 xxx 为您从 Aqara Studio 获取的 token
                }
            }
        }
    }
    ```

3. **Tools & MCP** 会显示刚才配置的 MCP 及连接状态。

    ![显示新增的 MCP](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-cursor4.png)

4. 在 Cursor 聊天框输入以下指令即可使用您增加的 MCP 进行对话：
    - **以下对话使用 Cursor MCP Servers 配置中的 LocalSmartDeviceControl 或 RemoteSmartDeviceControl**。
    - **以下对话使用 Cursor Tools & MCP 中配置的 LocalSmartDeviceControl 或 RemoteSmartDeviceControl 处理**。
    - 其他类似表达，只要能明确指出使用上述配置的 MCP 服务器，也都可以被识别和执行。

    :::tip
    如果 Cursor 显示未检测到 MCP，可以再次输入：**已经配置**，然后耐心等待 Cursor 完成 MCP 配置的确认。
    :::

    ![使用 MCP](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-cursor5.png)

## 在 Manus 上使用 MCP

:::tip
如需了解 Manus 官方关于如何连接 MCP Server 的详细说明，请参阅：[Custom MCP Servers - Connecting a Custom MCP Server](https://manus.im/docs/integrations/custom-mcp#connecting-a-custom-mcp-server)。
:::

1. 导航到 **Settings** → **Connectors**，点击 **Add Connectors**

    ![Add connectors](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-manus1.png)

2. 选择 **Custom MCP**，点击 **Add Custom MCP Server** -> 选择 **Import By JSON**

    ![Import By JSON](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-manus2.png)

3. 将以下 MCP Servers JSON 配置添加至弹窗中，然后点击 **Import** 按钮。

    ```json
    {
        "mcpServers": {
            /* 
             * 以下为通过远程访问 Aqara Studio MCP Server 的配置
             * SmartDeviceControl 为您自定义的 MCP server 名称 
             */
            "RemoteSmartDeviceControl": {
                "url": "https://xxx.xxx.xxx/open/api/mcp", // 替换 xxx.xxx.xxx 为 Aqara Studio 的远程访问地址
                "headers": {
                    "Authorization": "Bearer xxx" // 替换 xxx 为您从 Aqara Studio 获取的 token
                }
            }
        }
    }
   ```

    ![添加 MCP Servers](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-manus3.png)

4. 点击你创建的 MCP，点击 **Try it out**，就可以使用。

    ![Try it out](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-manus4.png)

5. 在聊天框输入：**使用名为 RemoteSmartDeviceControl 的自定义 MCP 进行对话**，即可调用该 MCP 服务。

    其他类似上述内容的表达也能用于调用该 MCP 服务。

    ![开始使用](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-manus5.png)


## 在 ChatGPT 上使用 MCP

:::tip
- 如需了解如何在 ChatGPT 上创建 MCP 应用的详细 OpenAI 官方说明，请参考：[ChatGPT Developer Mode - How to Use](https://platform.openai.com/docs/guides/developer-mode#how-to-use)。
- 请注意，根据 OpenAI 官方文档 [Developer mode, and MCP apps in ChatGPT【beta】 - Availability and requirements](https://help.openai.com/en/articles/12584461-developer-mode-and-mcp-apps-in-chatgpt-beta)，只有 ChatGPT Web 的 **Business** 和 **Enterprise/Edu** 用户才能使用 Apps、完整的 MCP 支持及开发者模式。因此，在开始使用 MCP 服务之前，请确认您的 ChatGPT 用户套餐满足要求。
:::


1. 导航到 **Settings** → **Apps**，点击 **Advanced settings**。
    
    ![选择 Advanced settings](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-ChatGPT1.png)

2. 开启 **Developer mode**，点击**Create app**

    ![创建 App](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-ChatGPT2.png)

3. 填写以下配置信息后，点击 **Create**。
    
    | 配置项                | 说明                                                         |
    |---------------------|------------------------------------------------------------|
    | Name               | 应用名称。                                                     |
    | Description        | 应用描述。                                                    |
    | MCP Server URL     | 采用 HTTPS 协议的 MCP Server 地址。                      |
    | Authentication     | 选择 **OAuth** 方式。OAuth ClientId 和 OAuth Client Secret 保持为空。                                            |

    ![填写配置](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-ChatGPT3.png)

4. 在 **Oauth授权登录页** 输入 [已获取的 Token](./set-up-mcp-server.mdx#获取-token)。

    ![填写 Token](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-ChatGPT4.png)

5. 在 **OAuth 授权确认页** 点击 **同意**，即可激活 MCP App。

    ![同意 OAuth 授权](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-ChatGPT5.png)

    :::tip
    如果您希望修改已输入的 Token，请在此页面单击 **退出登录**，即可返回至 **Oauth授权登录页**。
    :::

    ![App 详情](https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/MCP-ChatGPT6.png)

    :::tip
    每过 7 天，MCP App 的连接状态将变为 Disconnect。此时，只需返回 **Oauth 授权登录页**，重新输入您的 [Token](./set-up-mcp-server.mdx#获取-token)（无需重新生成），并完成授权，即可重新使用此 App
    :::

8. 在聊天框输入：**使用名为 RemoteSmartDeviceControl 的自定义 MCP 进行对话**，即可调用该 MCP 服务。

    其他类似上述内容的表达也能用于调用该 MCP 服务。

## 最佳实践

建议在控制设备前，先让 AI 查询该设备的功能定义，再进行操作。这样可以减少 AI 误判设备能力，从而显著提升操作的准确性和成功率。
